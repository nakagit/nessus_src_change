# nessus_src_change
Nessus で、送信元ポート番号を変更して、スキャンできるように、プラグインを編集するシェルスクリプト

<注意事項>  
※この方法は、サポート対象外となると思いますので、ご注意ください

※送信元ポート番号が変更できるプラグインと変更できないプラグインがあります

※事前に、プラグインのバックアップをお願いします

<プチ説明>

この方法では、下記 編集例のように、各プラグインファイル内の送信元ポート(sport)を指定します。

編集例 (送信元ポートを 53 番にする場合)

(編集前): soc = open_sock_tcp(port);

(編集後): soc = open_priv_sock_tcp(sport:53, dport:port);


---------------------------------------------------------------------------------------------
■実行例: 送信元ポートを 53番 にして Nessusを実行する方法

1) nessus_backup_plugins.sh を実行します。

   現在の Nessusプラグイン (/opt/nessus/lib/nessus/pluginsフォルダ) がバックアップされます。
   
   ※バックアップファイルは、/opt/nessus/lib/nessus/<日付>_<時間>_plugins.tar.gz です。
   
   [2,3分程度]


2) モード と 送信元ポートを指定して、nessus_src_change_plugins.sh を実行します。

   実行すると、/opt/nessus/lib/nessus/pluginsフォルダ内のプラグインファイルが編集されます。

   実行例: ./nessus_src_change_plugins.sh <Port> <Mode>

   指定したモードにより、シェルスクリプト実行時間が異なります。
   
   （  ）内は、(当時の)所要時間の目安です。

   ■3種類のモード
   (1) Normal モード      （約33分）
     ・ターミナル画面に、スクリプト実行状況が表示
     ・詳細ログ
     実行例 ./nessus_src_change_plugins.sh 53
   (2) Quick モード       （約26分）
     ・ターミナル画面に、スクリプト実行状況が表示されない
     ・詳細ログ
     実行例 ./nessus_src_change_plugins.sh 53 quick
   (3) Very Quick モード  （約17分）
     ・ターミナル画面に、スクリプト実行状況が表示されない
     ・（超）簡易ログ
     実行例 ./nessus_src_change_plugins.sh 53 vq


3) nessus_Rebuild_plugins_dbs.sh を実行します。

   Nessusプラグインのデータベースを再構築します。
     スクリプト実行中に下記を行います。
     (3.1.  Nessusサービス停止)
     (3.2.  Nessusプラグインのデータベース削除)
     (3.3.  Nessusプラグインのデータベース再構築 & Nessusサービス実行)
     [10分前後]

以上で、Nessus実行の準備完了です。


---------------------------------------------------------------------------------------------
■デフォルトのNessusプラグインに戻して、Nessusを実行する方法

1) nessus_restore_plugins.sh を実行します。
   
   デフォルトの Nessusプラグイン をリストアします。

   事前にバックアップしたファイル 「/opt/nessus/lib/nessus/<日付>_<時間>_plugins.tar.gz」を
   指定します。指定したバックアッププラグインが、/opt/nessus/lib/nessus/pluginsフォルダに 
   リストアされます。
   [1,2分程度]


2) nessus_Rebuild_plugins_dbs.sh を実行します。

   Nessusプラグインのデータベースを再構築します。
     スクリプト実行中に下記を行います。
     (2.1.  Nessusサービス停止)
     (2.2.  Nessusプラグインのデータベース削除)
     (2.3.  Nessusプラグインのデータベース再構築 & Nessusサービス実行)
     [10分前後]


以上で、Nessus実行の準備完了です。

---------------------------------------------------------------------------------------------
END
